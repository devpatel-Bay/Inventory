<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hotel Inventory & Sales Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Minimal styling (no Tailwind needed) -->
  <style>
    :root { --bg:#f6f6f7; --card:#fff; --border:#e5e7eb; --text:#111; --muted:#6b7280; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--text); }
    .container { max-width: 1200px; margin: 0 auto; padding: 16px; }
    header { display:flex; gap:8px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    h1 { font-size: 22px; font-weight: 700; }
    .btn { border:1px solid var(--border); background:#fff; padding:8px 12px; border-radius:14px; font-size:14px; cursor:pointer; }
    .btn.primary { background:#111; color:#fff; }
    .btn:active { transform: scale(.98); }
    .card { background:var(--card); border:1px solid var(--border); border-radius:18px; padding:16px; box-shadow: 0 1px 2px rgba(0,0,0,.03); margin-bottom:16px; }
    .card-title { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .input { width:100%; border:1px solid var(--border); border-radius:12px; padding:10px; font-size:14px; }
    .input[type="number"] { text-align:right; }
    .grid { display:grid; gap:12px; }
    @media (min-width: 768px){ .grid.cols-3 { grid-template-columns: 1fr 1fr 1fr; } }
    table { width:100%; border-collapse:collapse; font-size:14px; }
    thead tr { background:#f3f4f6; }
    th, td { text-align:left; padding:8px; border-bottom:1px solid var(--border); vertical-align: middle; }
    th.right, td.right { text-align:right; }
    .pill { display:inline-flex; border:1px solid var(--border); border-radius:999px; padding:2px 8px; font-size:12px; color:#374151; }
    .summary { display:grid; gap:12px; }
    @media (min-width:768px){ .summary { grid-template-columns:1fr 1fr 1fr; } }
    .tile { background:#fff; border:1px solid var(--border); border-radius:16px; padding:12px; }
    .tile .label { font-size:12px; color:var(--muted); }
    .tile .value { font-size:18px; font-weight:600; }
    .muted { color:var(--muted); }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,.3); display:grid; place-items:center; padding:16px; z-index:1000; }
    .modal { background:#fff; border:1px solid var(--border); border-radius:16px; width:100%; max-width:420px; padding:16px; box-shadow: 0 4px 16px rgba(0,0,0,.08); }
    code.code { background:#f3f4f6; padding:2px 4px; border-radius:4px; font-size:12px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React via CDN (no build tools) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for JSX in-browser (fine for small internal tools) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    /** Persistence keys */
    const LS_KEY = "hotel_inventory_v1";
    const LS_SALES_KEY = "hotel_sales_v1";
    const LS_ADMIN_PASS = "hotel_admin_pass_v1";

    const currency = (n) => isNaN(n) ? "-" : n.toLocaleString(undefined, { style:"currency", currency:"USD" });

    function todayKey(){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${day}`;
    }
    const isToday = (ts) => {
      try { return new Date(ts).toISOString().slice(0,10) === todayKey(); } catch { return false; }
    };

    function loadInventory(){
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return defaultInventory();
      try { const p = JSON.parse(raw); return Array.isArray(p) ? p : defaultInventory(); }
      catch { return defaultInventory(); }
    }
    function saveInventory(items){ localStorage.setItem(LS_KEY, JSON.stringify(items)); }

    function loadSales(){
      const raw = localStorage.getItem(LS_SALES_KEY);
      if(!raw) return [];
      try { const p = JSON.parse(raw); return Array.isArray(p) ? p : []; }
      catch { return []; }
    }
    function saveSales(sales){ localStorage.setItem(LS_SALES_KEY, JSON.stringify(sales)); }

    function defaultInventory(){
      return [
        { id: crypto.randomUUID(), barcode:"0123456789012", name:"Bottled Water 16oz", priceSold:1.99, vendorCost:0.45, startingInventory:50, category:"Drinks" },
        { id: crypto.randomUUID(), barcode:"1234567890123", name:"Chips - Classic",    priceSold:2.49, vendorCost:0.65, startingInventory:40, category:"Snacks" },
        { id: crypto.randomUUID(), barcode:"2345678901234", name:"Chocolate Bar",      priceSold:2.99, vendorCost:0.85, startingInventory:35, category:"Snacks" }
      ];
    }

    function getAdminPass(){ return localStorage.getItem(LS_ADMIN_PASS) || "admin123"; }
    function setAdminPass(pass){ localStorage.setItem(LS_ADMIN_PASS, pass); }

    /** Reusable UI */
    const Button = ({ children, className="", ...props }) => <button {...props} className={"btn "+className}>{children}</button>;
    const Card = ({ title, actions, children }) => (
      <div className="card">
        <div className="card-title">
          <h3 style={{margin:0, fontSize:16, fontWeight:600}}>{title}</h3>
          <div className="actions">{actions}</div>
        </div>
        {children}
      </div>
    );
    const Pill = ({children}) => <span className="pill">{children}</span>;
    const SummaryTile = ({ label, value }) => (
      <div className="tile">
        <div className="label">{label}</div>
        <div className="value">{value}</div>
      </div>
    );

    function PasswordModal({ onClose, onSuccess }){
      const [pass, setPass] = useState("");
      const [error, setError] = useState("");
      function submit(){
        if(pass === getAdminPass()) onSuccess();
        else setError("Incorrect password");
      }
      return (
        <div className="modal-backdrop">
          <div className="modal">
            <h3 style={{marginTop:0}}>Enter Admin Password</h3>
            <input className="input" type="password" placeholder="Password" value={pass} onChange={e=>setPass(e.target.value)} />
            {error && <div style={{color:"#dc2626", marginTop:6, fontSize:14}}>{error}</div>}
            <div style={{display:"flex", gap:8, justifyContent:"flex-end", marginTop:12}}>
              <Button onClick={onClose}>Cancel</Button>
              <Button className="primary" onClick={submit}>Unlock</Button>
            </div>
            <div className="muted" style={{fontSize:12, marginTop:8}}>Default password is <b>admin123</b>. Change it in Admin → Change Password.</div>
          </div>
        </div>
      );
    }

    function ChangePasswordButton(){
      const [open, setOpen] = useState(false);
      return (
        <>
          <Button onClick={()=>setOpen(true)}>Change Password</Button>
          {open && <ChangePasswordModal onClose={()=>setOpen(false)} />}
        </>
      );
    }
    function ChangePasswordModal({ onClose }){
      const [current, setCurrent] = useState("");
      const [next, setNext] = useState("");
      const [confirm, setConfirm] = useState("");
      const [error, setError] = useState("");
      function save(){
        if(current !== getAdminPass()) return setError("Current password is incorrect");
        if(!next) return setError("New password cannot be empty");
        if(next !== confirm) return setError("Passwords do not match");
        setAdminPass(next);
        onClose();
      }
      return (
        <div className="modal-backdrop">
          <div className="modal">
            <h3 style={{marginTop:0}}>Change Admin Password</h3>
            <div className="grid">
              <input className="input" type="password" placeholder="Current password" value={current} onChange={e=>setCurrent(e.target.value)} />
              <input className="input" type="password" placeholder="New password" value={next} onChange={e=>setNext(e.target.value)} />
              <input className="input" type="password" placeholder="Confirm new password" value={confirm} onChange={e=>setConfirm(e.target.value)} />
              {error && <div style={{color:"#dc2626"}}>{error}</div>}
            </div>
            <div style={{display:"flex", gap:8, justifyContent:"flex-end", marginTop:12}}>
              <Button onClick={onClose}>Cancel</Button>
              <Button className="primary" onClick={save}>Save</Button>
            </div>
          </div>
        </div>
      );
    }

    /** Front Desk (scan) */
    function FrontDeskView({ products, recordSale, undoLastSale, filter, setFilter, totals }){
      const [last, setLast] = useState(null);
      const inputRef = useRef(null);
      useEffect(()=>{ inputRef.current?.focus(); },[]);
      function handleScan(e){
        if(e.key === "Enter"){
          const code = e.currentTarget.value.trim();
          const prod = products.find(p => p.barcode === code);
          if(prod){
            recordSale(code, 1);
            setLast({ code, name: prod.name, price: prod.priceSold });
          } else {
            setLast({ code, name: "Unknown barcode", price: 0 });
          }
          e.currentTarget.value = "";
        }
      }
      return (
        <div>
          <Card title="Scan Items" actions={
            <>
              <Button onClick={undoLastSale}>Undo Last Sale (Today)</Button>
            </>
          }>
            <div className="grid cols-3">
              <div style={{gridColumn:"span 2"}}>
                <div style={{fontSize:13, marginBottom:6}}>Barcode Input</div>
                <input ref={inputRef} className="input" placeholder="Click here and scan a product (press Enter)" onKeyDown={handleScan} />
                {last && (
                  <div className="muted" style={{fontSize:14, marginTop:8}}>
                    Last Scan: <b>{last.name}</b> ({last.code}) • {currency(last.price)}
                  </div>
                )}
              </div>
              <div>
                <div style={{fontSize:13, marginBottom:6}}>Quick Search</div>
                <input className="input" placeholder="Filter by name, barcode, category"
                       value={filter} onChange={e=>setFilter(e.target.value)} />
              </div>
            </div>
          </Card>

          <InventoryTable products={products} />

          <Card title="Today Summary">
            <div className="summary">
              <SummaryTile label="Units Sold Today" value={totals.unitsSold} />
              <SummaryTile label="Revenue (Price × Units)" value={currency(totals.revenue)} />
              <SummaryTile label="Ending Inventory Value (Vendor Cost)" value={currency(totals.endCost)} />
            </div>
          </Card>
        </div>
      );
    }

    /** Admin */
    function AdminView({ products, inventory, setInventory, filter, setFilter, addProduct, exportCSV, importCSV, sales, setSales, totals, setTab, setAdminUnlocked }){
      const [editingId, setEditingId] = useState(null);
      function updateField(id, field, value){
        setInventory(prev => prev.map(p => p.id === id ? ({...p, [field]: value}) : p));
      }
      function removeProduct(id){
        if(!confirm("Remove this product?")) return;
        setInventory(prev => prev.filter(p => p.id !== id));
      }
      function adjustStarting(id, delta){
        setInventory(prev => prev.map(p => p.id === id ? ({...p, startingInventory: Math.max(0,(p.startingInventory||0)+delta)}) : p));
      }
      function clearTodaySales(){
        if(!confirm("Clear today’s sales events? (Only today)")) return;
        const day = todayKey();
        setSales(prev => prev.filter(s => s.ts.slice(0,10) !== day));
      }
      function handleImport(ev){
        const file = ev.target.files?.[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => importCSV(String(reader.result||""));
        reader.readAsText(file);
        ev.target.value = "";
      }
      return (
        <div>
          <Pill>Admin Mode</Pill>
          <Card title="Admin Controls" actions={
            <>
              <Button onClick={addProduct}>Add Product</Button>
              <label className="btn" style="cursor:pointer;">
                Import CSV
                <input type="file" accept=".csv" style="display:none" onChange={handleImport} />
              </label>
              <Button onClick={exportCSV}>Export CSV</Button>
              <Button onClick={clearTodaySales}>Clear Today Sales</Button>
              <ChangePasswordButton />
            </>
          }>
            <div className="grid cols-3">
              <div style={{gridColumn:"span 2"}}>
                <div style={{fontSize:13, marginBottom:6}}>Search / Filter</div>
                <input className="input" placeholder="Filter by name, barcode, category"
                       value={filter} onChange={e=>setFilter(e.target.value)} />
              </div>
              <div style={{display:"flex", alignItems:"flex-end", justifyContent:"flex-end"}}>
                <div style={{textAlign:"right", fontSize:14}}>
                  <div><b>Units Sold Today:</b> {totals.unitsSold}</div>
                  <div><b>Revenue Today:</b> {currency(totals.revenue)}</div>
                  <div><b>Ending Inventory Value:</b> {currency(totals.endCost)}</div>
                </div>
              </div>
            </div>
          </Card>

          <Card title="Product Catalog (Editable)">
            <div style={{overflow:auto}}>
              <table>
                <thead>
                  <tr>
                    <th>Product</th>
                    <th>Barcode</th>
                    <th>Category</th>
                    <th class="right">PRICE SOLD</th>
                    <th class="right">VENDOR COST</th>
                    <th class="right">STARTING INVENTORY</th>
                    <th class="right">UNITS SOLD TODAY</th>
                    <th class="right">ENDING INVENTORY</th>
                    <th class="right">PRICE SOLD X UNITS SOLD</th>
                    <th class="right">ENDING INVENTORY (X) VENDOR COST</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {products.map(p => (
                    <tr key={p.id}>
                      <td>
                        {editingId === p.id ? (
                          <input className="input" value={p.name} onChange={e=>updateField(p.id,"name",e.target.value)} />
                        ) : (
                          <div style={{fontWeight:600}}>{p.name}</div>
                        )}
                      </td>
                      <td>
                        {editingId === p.id ? (
                          <input className="input" value={p.barcode} onChange={e=>updateField(p.id,"barcode",e.target.value)} />
                        ) : (
                          <code class="code">{p.barcode || "—"}</code>
                        )}
                      </td>
                      <td>
                        {editingId === p.id ? (
                          <input className="input" value={p.category||""} onChange={e=>updateField(p.id,"category",e.target.value)} />
                        ) : (p.category || "—")}
                      </td>
                      <td class="right">
                        {editingId === p.id ? (
                          <input className="input" type="number" step="0.01" value={p.priceSold}
                                 onChange={e=>updateField(p.id,"priceSold", parseFloat(e.target.value)||0)} />
                        ) : currency(p.priceSold)}
                      </td>
                      <td class="right">
                        {editingId === p.id ? (
                          <input className="input" type="number" step="0.01" value={p.vendorCost}
                                 onChange={e=>updateField(p.id,"vendorCost", parseFloat(e.target.value)||0)} />
                        ) : currency(p.vendorCost)}
                      </td>
                      <td class="right">
                        {editingId === p.id ? (
                          <div style={{display:"flex", gap:8, justifyContent:"flex-end"}}>
                            <button className="btn" onClick={()=>adjustStarting(p.id,-1)}>-1</button>
                            <input className="input" type="number" value={p.startingInventory}
                                   onChange={e=>updateField(p.id,"startingInventory", parseInt(e.target.value)||0)} />
                            <button className="btn" onClick={()=>adjustStarting(p.id,1)}>+1</button>
                          </div>
                        ) : p.startingInventory}
                      </td>
                      <td class="right">{p.soldToday}</td>
                      <td class="right">{p.endingInv}</td>
                      <td class="right">{currency(p.revenueToday)}</td>
                      <td class="right">{currency(p.endingInvCost)}</td>
                      <td class="right">
                        {editingId === p.id ? (
                          <div style={{display:"flex", gap:8, justifyContent:"flex-end"}}>
                            <Button onClick={()=>setEditingId(null)}>Save</Button>
                            <Button onClick={()=>removeProduct(p.id)}>Delete</Button>
                          </div>
                        ) : (
                          <div style={{display:"flex", gap:8, justifyContent:"flex-end"}}>
                            <Button onClick={()=>setEditingId(p.id)}>Edit</Button>
                          </div>
                        )}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Card>

          <Card title="Day Close Summary (Today)">
            <DayClose products={products} />
          </Card>

          <div style={{display:"flex", justifyContent:"flex-end"}}>
            <Button onClick={()=>{ setAdminUnlocked(false); setTab('front'); }}>
              Lock Admin & Return to Front Desk
            </Button>
          </div>
        </div>
      );
    }

    function DayClose({ products }){
      const totalUnits = products.reduce((a,p)=>a+p.soldToday,0);
      const totalRevenue = products.reduce((a,p)=>a+p.revenueToday,0);
      const totalEndCost = products.reduce((a,p)=>a+p.endingInvCost,0);
      return (
        <div className="summary">
          <SummaryTile label="Units Sold Today" value={totalUnits} />
          <SummaryTile label="Revenue (Price × Units)" value={currency(totalRevenue)} />
          <SummaryTile label="Ending Inventory Value (Vendor Cost)" value={currency(totalEndCost)} />
        </div>
      );
    }

    function InventoryTable({ products }){
      return (
        <div className="card">
          <div className="card-title"><h3 style={{margin:0, fontSize:16, fontWeight:600}}>Inventory</h3></div>
          <div style={{overflow:auto}}>
            <table>
              <thead>
                <tr>
                  <th>Product List</th>
                  <th class="right">PRICE SOLD</th>
                  <th class="right">VENDOR COST</th>
                  <th class="right">STARTING INVENTORY</th>
                  <th class="right">UNITS SOLD TODAY</th>
                  <th class="right">ENDING INVENTORY</th>
                  <th class="right">PRICE SOLD X UNITS SOLD</th>
                  <th class="right">ENDING INVENTORY (X) VENDOR COST</th>
                </tr>
              </thead>
              <tbody>
                {products.map(p => (
                  <tr key={p.id}>
                    <td>
                      <div style={{display:"flex", alignItems:"center", gap:8}}>
                        <div style={{fontWeight:600}}>{p.name}</div>
                        <Pill>{p.barcode || "no barcode"}</Pill>
                      </div>
                    </td>
                    <td class="right">{currency(p.priceSold)}</td>
                    <td class="right">{currency(p.vendorCost)}</td>
                    <td class="right">{p.startingInventory}</td>
                    <td class="right">{p.soldToday}</td>
                    <td class="right">{p.endingInv}</td>
                    <td class="right">{currency(p.revenueToday)}</td>
                    <td class="right">{currency(p.endingInvCost)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    /** App */
    function App(){
      const [tab, setTab] = useState("front"); // 'front' | 'admin'
      const [inventory, setInventory] = useState(loadInventory());
      const [sales, setSales] = useState(loadSales());
      const [filter, setFilter] = useState("");
      const [adminUnlocked, setAdminUnlocked] = useState(false);
      const [showPassModal, setShowPassModal] = useState(false);

      useEffect(()=>saveInventory(inventory),[inventory]);
      useEffect(()=>saveSales(sales),[sales]);

      const todaySalesMap = useMemo(()=>{
        const map = new Map();
        for(const s of sales){
          if(!isToday(s.ts)) continue;
          map.set(s.barcode, (map.get(s.barcode)||0) + (s.qty||0));
        }
        return map;
      },[sales]);

      const products = useMemo(()=>{
        return inventory
          .map(p => {
            const soldToday = todaySalesMap.get(p.barcode) || 0;
            const endingInv = Math.max(0, (p.startingInventory||0) - soldToday);
            const revenueToday = (p.priceSold||0) * soldToday;
            const endingInvCost = (p.vendorCost||0) * endingInv;
            return {...p, soldToday, endingInv, revenueToday, endingInvCost};
          })
          .filter(p => {
            const q = filter.trim().toLowerCase();
            if(!q) return true;
            return p.name.toLowerCase().includes(q)
              || (p.barcode||"").toLowerCase().includes(q)
              || (p.category||"").toLowerCase().includes(q);
          });
      }, [inventory, todaySalesMap, filter]);

      const totals = useMemo(()=>{
        let unitsSold=0, revenue=0, endCost=0;
        for(const p of products){ unitsSold+=p.soldToday; revenue+=p.revenueToday; endCost+=p.endingInvCost; }
        return { unitsSold, revenue, endCost };
      },[products]);

      function recordSale(barcode, qty=1){
        if(!barcode) return;
        const prod = inventory.find(p=>p.barcode===barcode);
        if(!prod) return;
        setSales(prev => [...prev, { barcode, qty, ts: new Date().toISOString() }]);
      }
      function undoLastSale(){
        const idx = [...sales].map((s,i)=>({s,i})).filter(({s})=>isToday(s.ts)).map(({i})=>i).pop();
        if(idx===undefined) return;
        const copy = [...sales]; copy.splice(idx,1); setSales(copy);
      }
      function addProduct(){
        setInventory(prev => [...prev, { id:crypto.randomUUID(), barcode:"", name:"New Product", priceSold:0, vendorCost:0, startingInventory:0, category:"" }]);
      }
      function importCSV(text){
        const rows = text.split(/\r?\n/).filter(Boolean); if(!rows.length) return;
        const headers = rows[0].split(",").map(h=>h.trim());
        const idx = (k)=> headers.indexOf(k);
        const out = [];
        for(let i=1;i<rows.length;i++){
          const cols = rows[i].split(",");
          if(!cols.length) continue;
          out.push({
            id: crypto.randomUUID(),
            barcode: cols[idx("barcode")]?.trim() || "",
            name: cols[idx("name")]?.trim() || "",
            priceSold: parseFloat(cols[idx("priceSold")]) || 0,
            vendorCost: parseFloat(cols[idx("vendorCost")]) || 0,
            startingInventory: parseInt(cols[idx("startingInventory")]) || 0,
            category: cols[idx("category")]?.trim() || "",
          });
        }
        if(out.length) setInventory(out);
      }
      function exportCSV(){
        const headers = ["barcode","name","priceSold","vendorCost","startingInventory","category"];
        const body = inventory.map(p => [p.barcode,p.name,p.priceSold,p.vendorCost,p.startingInventory,p.category||""].map(x=>String(x).replaceAll(",","")).join(",")).join("\n");
        const csv = headers.join(",") + "\n" + body;
        const blob = new Blob([csv], {type:"text/csv"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = `inventory_${todayKey()}.csv`; a.click();
        URL.revokeObjectURL(url);
      }
      function openAdmin(){
        if(adminUnlocked){ setTab("admin"); }
        else { setShowPassModal(true); }
      }

      return (
        <div className="container">
          <header>
            <h1>Hotel Inventory & Sales Tracker</h1>
            <div className="actions">
              <Button className={tab==="front" ? "primary":""} onClick={()=>setTab("front")}>Front Desk (Scan)</Button>
              <Button className={tab==="admin" ? "primary":""} onClick={openAdmin}>Admin</Button>
            </div>
          </header>

          {tab === "front" ? (
            <FrontDeskView
              products={products}
              recordSale={recordSale}
              undoLastSale={undoLastSale}
              filter={filter}
              setFilter={setFilter}
              totals={totals}
            />
          ) : (
            <AdminView
              products={products}
              inventory={inventory}
              setInventory={setInventory}
              filter={filter}
              setFilter={setFilter}
              addProduct={addProduct}
              exportCSV={exportCSV}
              importCSV={importCSV}
              sales={sales}
              setSales={setSales}
              totals={totals}
              setTab={setTab}
              setAdminUnlocked={setAdminUnlocked}
            />
          )}

          {showPassModal && (
            <PasswordModal
              onClose={()=>setShowPassModal(false)}
              onSuccess={()=>{
                setAdminUnlocked(true);
                setShowPassModal(false);
                setTab("admin");
              }}
            />
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
