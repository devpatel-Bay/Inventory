<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hotel Inventory Tracker</title>
<style>
body{font-family:sans-serif;margin:0;background:#f6f6f7;color:#111} 
.btn{padding:8px 12px;border:1px solid #ccc;border-radius:8px;cursor:pointer}
.table{width:100%;border-collapse:collapse;font-size:14px}th,td{border-bottom:1px solid #ddd;padding:6px}th{background:#f3f4f6;text-align:left}
.card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:12px;margin:12px 0}
</style>
</head>
<body>
<div style="max-width:1100px;margin:auto;padding:12px">
<h2>Hotel Inventory Tracker</h2><div style="font-size:12px;color:#555">Local Time (CST): <span id="clock"></span></div>
<div style="display:flex;gap:6px;margin-top:8px">
<button id="adminBtn" class="btn">Admin</button>
<button id="setupBtn" class="btn">Setup</button>
</div>

<!-- Admin -->
<div id="adminView" class="card" style="display:none">
<h3>Admin Daily Summary</h3>
<div style="margin-bottom:6px">Date: <input id="summaryDate" type="date" class="btn" style="padding:4px"></div>
<div id="summaryContainer"><p>Loading...</p></div>
</div>

<!-- Setup -->
<div id="setupView" class="card" style="display:none">
<h3>Setup</h3>
<p><input id="hotelName" placeholder="Hotel name" class="btn" style="width:100%"></p>
<p><input id="gasUrl" placeholder="Apps Script URL /exec" class="btn" style="width:100%"></p>
<button id="saveSetup" class="btn">Save</button>
</div>
</div>

<script>
const LS_GAS='gas_webapp_url',LS_HOTEL='hotel_name';
const getGAS=()=>localStorage.getItem(LS_GAS)||'',setGAS=v=>localStorage.setItem(LS_GAS,v);
const getHotel=()=>localStorage.getItem(LS_HOTEL)||'Hotel',setHotel=v=>localStorage.setItem(LS_HOTEL,v);
const clock=document.getElementById('clock'),adminBtn=document.getElementById('adminBtn'),setupBtn=document.getElementById('setupBtn'),
adminView=document.getElementById('adminView'),setupView=document.getElementById('setupView'),
summaryContainer=document.getElementById('summaryContainer'),summaryDate=document.getElementById('summaryDate'),
hotelName=document.getElementById('hotelName'),gasUrl=document.getElementById('gasUrl');

function tick(){clock.textContent=new Date().toLocaleString('en-US',{timeZone:'America/Chicago'});} setInterval(tick,1000);tick();

async function fetchSummary(d){
 summaryContainer.innerHTML='Loading...';
 try{
  const r=await fetch(getGAS(),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'summary',date:d})});
  const t=await r.text();const j=JSON.parse(t);if(!j.ok)throw new Error(j.error);
  const items=j.items||[];if(!items.length)return summaryContainer.innerHTML=`<p>No sales for ${d}</p>`;
  let h=`<table class="table"><tr><th>Product</th><th>Barcode</th><th>Price</th><th>Sold</th><th>Revenue</th><th>Start</th><th>End</th></tr>`;
  let totR=0,totU=0;for(const x of items){h+=`<tr><td>${x.name}</td><td>${x.barcode}</td><td>$${x.price.toFixed(2)}</td><td>${x.qty}</td><td>$${x.revenue.toFixed(2)}</td><td>${x.start}</td><td>${x.end}</td></tr>`;totR+=x.revenue;totU+=x.qty;}
  h+=`</table><p><b>Total Units:</b> ${totU} | <b>Total Revenue:</b> $${totR.toFixed(2)}</p>`;summaryContainer.innerHTML=h;
 }catch(e){summaryContainer.innerHTML=`<p style="color:red">Error: ${e.message}</p>`;}
}
adminBtn.onclick=()=>{adminView.style.display='block';setupView.style.display='none';const d=new Date().toISOString().split('T')[0];summaryDate.value=d;fetchSummary(d);}
setupBtn.onclick=()=>{setupView.style.display='block';adminView.style.display='none';hotelName.value=getHotel();gasUrl.value=getGAS();}
document.getElementById('saveSetup').onclick=()=>{setHotel(hotelName.value.trim());setGAS(gasUrl.value.trim());alert('Saved');};
summaryDate.onchange=()=>fetchSummary(summaryDate.value);
</script>
</body></html>
